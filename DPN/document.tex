\documentclass[]{report}
\usepackage[english, russian]{babel}
\usepackage[T2A]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage{amssymb,amsfonts,amsmath,mathtext,cite,enumerate,float}
\usepackage[pdftex]{graphicx} 
\graphicspath{{images/}}

% Title Page
\title{Обработка изображений}
\author{иколаев Д. П.}


\begin{document}
\maketitle

\begin{abstract}
	организационные моменты
	на сдаче:
		1 вопрос по выбору студента - идеаль
		2 вопроса по выбору преподователя
		задача в зависимости от сложности
	можно выступить в течение семестра с докладом по части курса +1/2 балла
	сделать методичку? по теме
	опасные вопросы - вопросы про цвет, быстрое преобразование хафа
	хорошо гуглится - сжатие изображений
	задачи забиваются заранее.
	в разные дни можно отвечать 1 и тот же вопрос
	
	учебник - гонсалес/вудс, йане??, красивеньких "цифровая обработка изображений"
	про цвет - кандидатская дисертация димы
\end{abstract}

\chapter{сделать}

\chapter{lecture1}

\section{введение}
Что такое изображение, к примеру фотографическое изображение.
не протяженные во времени объекты. в основном двумерные объекты.
Изобрадение это некоторый результат измерения, обычночно с пространственн выразимый в виде nмерный значений и несущее какую либо информации. 

срез полиморфической?? функции. Измеряем потоки света, а хотим понять про отражательные свойства и объекты трехмерной сцены расположенной перед фотоаппаратом. Можно работать с акустичискими, ренгеновскими изобрадениями.

Постановка задачи обрабоки изобрадений в широком смысле
В узком смысле 
\begin{itemize}
	\item анализ изображений - на выходе параметры изобрадения
	\item обработка - на выходе изображения
	\item синтез изображения - на входе параметры на выходе изобрадения
\end{itemize}

Что еще делаем с изображанием - сжатие изображения - анализ + синтез изображений

Обработка изображений:
\begin{itemize}
	\item восстановление изображения(super resolution, фильтрация)
	\item редактирование изображений(закрыть дырку на изображении (свести к миниму градиек=нт на краях...), правдоподобно вклеить объект в изображение)
\end{itemize}

анализ изображений: распознавание, выделение углов и т.д

где используется:везде:медицина, транспорт (штрафы, платные дороги), военные, финансовая безопасность, маркетинг, физика (геофизика, астрономия), нефть (томография)

Математический аппарат(требуется):
\begin{itemize}
	\item дискран (алгоритмы на дискретных структурах)
	\item численные методы
	\item линейная алгебра
	\item урматы, дифуры
	\item матан, чуть-чуть
	\item статистика
	\item проэктивная геометрия
	\item оптимизация
\end{itemize}

Изображение - работаем с растром и говорим, что это изобрадение
пусть существует сколько-то мерная таблица, в узлах которой - математической объекты
есть несколько осей координат и задана евклидова система

кроме растра существует векторное изобрадение (объектное). 

в растре может храниться:
\begin{itemize}
	\item битики (черно-белые изображения, жесткие маски)
	\item скаляр (уровень сигнала, серые, скалярные изображения)
	\item вектор (цветное изображение, векторное)
\end{itemize}

Обсудим случайно выбранную задачу обработки изображений.
Отличие обработки изображений от обработки сигналов.
в обработке сигланов очень хорошо работают линейные методы (фурье, вейвлеты), в обработке изображений - очень плохо.
Почему?
в обработке сигналов - сигналы акустические, электромагнитные. непрерывные сигланы (как правило)
про изобрадение так сказать нельзя
ибо изображение это проекция и при проекции 3рех мерного мира на 2ух мерный существуют заслонения, разрывы глубины, разрывы свойств объектов на разных планах.

необходима частотная разделимость сигнала и шума - тогда линейные методы хорошо работают

любые линейные фильтры будут сглаживать границы и размывать, что неприемлемо в обработке изображений

модель изображения - кусочно-гладкая функция с разрывами образующими граф, ребрами которого являются кусочно гладкие разрывы
границы могут начинаться из какой-то точки и ни к чему не присоединяться

рассмотрим линейный метод фильтрации, окно размера m
сглаживание - преобраование фурье, обработка спектра (свертка) - обратное преобразование. не устраивае сложность n**2
dзять среднее по окну nlog(m)

Хотим за o(n) 
способы
1. построить итегральное изображение
2. зная предидущую сумму вычисляем следующую за 2 действия (О(2n))
2.1 хотим фильтр с осхраниением границ - менять размер окна в зависимости от изображения
2.2 основная теорме матанализа - формула ньютона лейбница площадь под изображением равна разнице первообразных.
2.3 формула посмотреть у иры (ильи)
2.3 что считаем?? 
2.4 получилось за О(2n)

Всегда следим за сложностью.

Представление чисел.
Пусть сигнал 8 бит. n=2**30, m=200
подсчитали 255*2**30=2**38, влезает в 2**64 в 64 бита однако достаточно 16
что будет, если 16бит то в какой-то момент произойдет переполение и старший бит пропадет
получим лесенку (картинка у ильи) 
в одно окно попадет максимум один разрыв

пока в одно окно попадает максимум одно переполение - все хорошо.

проблема потери точности:
осторожно с флоатами. когда мы накапливаем что-то большое во float то вначале все приводится к одному показателю, а потом складывается
если меньшее число не попадает в мантису больше то большее число не изменится

осторожно с округлением вниз - можно потерять сигнал

проблема дрейфа значений - когда прибавляем, вычитаем - складываются погрешности и будут уплывать значения к правой части картинки

\section{регистрация изображений}
Изображение непрозрачных объектов в видимом диапазоне

Камера
простейшая модель камеры - камера обскура.
маленькая дырка перед экраном в темной комнате
практически идеальна по парамерам дисторсии оберации
светисила очень маленькая
использовалась художниками для получения реалистичных картин
ящик с дырочкой (картинка у иры)
заднее фокусное растояние - растояние между экраном и дыркой
глубина резкости - насколько можно уходить из фокусной плоскости
передние, задние фокусные расстояние, фокусная плоскость -
расфокусировка - 
меняем резкость - меняем переднее фокусное растояне
меняем зум - заднее фокусное расстояние

чем хорошая камера хуже камеры обскура
веньетирование - изображение темнее к краям - элемент площади светочувствительной матрицы находящийся скраю, отвечает за меньший телесный угол, чем находящийся в центре матрицы

калибровка для веньетирование - запоминание коэфициентов усиления для каждого пикселя по отдельности
размениваем веньетирование на возрастание уровня шумов

дефокусировка - (для камера обскура - не все лучи проходят через одну точку и в каждой точке мы наблюдаем лучи еще и для соседних пикселей - можно считать, что была вычислена свертка со сглаживающим ядром) 

свертка - вызывает дефокусировку
ядро свертки - функция рассеянья точки или аппаратная функция

$f(x)*g(x) = \int f(x)*g(x-a)dx$

можно ли дефокусировку откалибровать?
b да и нет
по идее обратная свертка существует
но это ядро - сглаживающее
а вообще говорим, что нет
это не калибровка - это серьезная фильтрация с массой побочных эффектов

смаз - проявляется только в разговорох о времени - на изображении может быть движущийся объект, необходимо время для интегрирования яркости (время выдержки).
если за время выдержки местоположение объекат изменилось - изображение получится смазанным
или движежущаяся камера
смаз можно  записать как свертку идеальной картинки с функцией ...
смаз и дефокусировка - нелинейная сверка
смаз из-за врещения камеры нельзя записать как свертку

хроматические абберации - у линзы разная плотность для разных длин волн и как следствие фокусное растояние тоже разное и разные длины волн накладываются друг на груг
получаем двоение границ
если глубины резкости хватает и мы не говорим, что для разных длин волн дефокус разный
разные цветовые каналы имеют разный размер и это можно учесть и скалибровать

разные каналы будут проэктивно сводимы

если оптическая ось не перпендикулярна матрице - это часть тангенциальной дисторсии
проэктивное преобразование? 8 параметров
$$x=\frac{ax+by+c}{gx+hy+i}$$
$$y=\frac{dx+ey+f}{gx+hy+i}$$
афинное - 6 параметров преобразование


Пуасоновский шум
увеличение шума, уменьшение шума но увеличение смаза

Апертура

Байдеровская мозайка

Гамма коррекция

\chapter{лекция2}

\section{цветность, цветовое пространство}
в глазу колбочки (для дня) и палочки (для ночи)
в сумерках работают 4 канала

в камере тоже светочувствительные элементы.
рассмотрим 1 элемент, он считает падующие фотоны, с определенными видами волн
рис 1 - блокнот
рис 2 - функция светочувствительности элемента (спектральная характеристика детектора)

фотоны между собой не взаимодействуют, с красителем взаиможействуют до насыщения



неизвестная линейная функция о $a_i$
интеграл

$F(\lambda)$ - спектральная характеристика, неотрицательная, не образует линейное пространство - выпуклый конус

при линейном преобразовании F -> a

=> a - выпуклый трехмерный конус

множество а - не покрывает положительныф октант, ибо не может одновременно одинаково ярко видеть все цвета (одной колбочкой)

всевозможные достижимые точки цветого пространства называют цветовым конусом, и характеризуются чувствительностью - хи

сечение плоскотью проходящей через начало координат - цветовой треугольник

все возможные цветовые треугольники образованные одним конусом - проэктивно подобны
цветовой треугольник человека - рис3 - двуугольник

цветим лазером от инфокрасного до ультрофиолетового, это образует петлю рис 4 - с одной точкой излома. проэцируем на плоскость цветности (считаем касательные)

касательные в нуле - разные - переходят в разные точки. рис 5

фиолетовые цвета - не спектральные. так как не существует пурпурного лазера

цветность - то, что не меняется, когда меняется яркость. яркость - мощностная характеристика входного излучения без измененния длины волны

цветность двумерна

не зависящая от длины волны характеристика окраски - светлота
не зависящая от длины волны характеристика излучения - яркость

рис 6
хотим извлечь информацию об отражающей поверхности
главная задача цветового зрения - определение характеристик окрасок объектов

способность биологического зрения решать поставленную задачу - фуномен цветовой константности

что такое окраска?

каждую точку излучающей поверхности характеризуем спектральной индикатриссой излучения $B(r, \lambda)$

r - направление, размерность 2

$B(r, \lambda) = B(r)*S(\lambda)$ - не работает для витражных стекол

с окраской - спектральная индикатриса рассеянья (характеристика отражающей способности)
чтобы охарактиризовать каждую точку объекта нужна функция $G(r_{out}, r_{in}, \lambda)$ - G?
спектральная двулучевая функция отражающей способности

у нас нет нелинейных объектов, только линейное рассеянье - поэтому одна $\lambda$

можем вынести за скобку спектральные характеристики? не фига

доказательство - белый блик. он бы не существовал

для диэликтрических глянцевых объектов можно записать данное разложение $G = G_1()*\phi(\lambda)+G_2*\phi(\lambda)$

одна компонента диффузная, другая - зеркальная. у зеркальной $\phi 2$ - константа. не всегда белый

$G_2$ -  матовое $G_1$ - глянцевое - ламбертова - переизлучает в половине телесных углов одинаково - не так

все неправда.
зеркальная компонента - то, что возникает на поверхности, диффузная возникает в толще.

металлы и хорошо матированные диэлектрики имеют один член разложения, большинство гладких диэлектриков - 2. бывает больше - 3. 

dводим понятие цветового тела - подмножество цветового пространства, которое достижимо при наблюдении всех сцен при зафиксированном источнике

цветовой конус параметризован чувствительностью глаза

цветовое тело выпукло, не конус, центральносииметрично (относительно точки, соответствующей нейтрально серой окраске (1/2, 1/2))
рис 7

теорема максимова - по форме цветового тела, можно восстаность спектральные характеристики источника света. - не применимо на практике - все точки сцены освещаются в разной мощностью


метомирии излучений и окрасок

метомирия излучений - это свойство разных излучений давать одну и туже реакцию

метомирия окрасок - это разные красители, с разным споктром излучния могут оказаться неразличиными для определенного сенсора и при определенном излучении

$\int_0^\infty s_1(\lambda)\phi_1(\lambda)\chi_1(\lambda)d\lambda = \int_0:\infty s_2(\lambda)\phi_2(\lambda)\chi_2(\lambda)d \lambda$


\section{цветовые пространства}


$a_c = \int_0^\infty F(\lambda)\chi_c(\lambda)$

$a_h = \int_0^\infty F(\lambda)\chi_h(\lambda)$

зная $a_c, a_h, \chi_c, \chi_h$ - нельзя восстановить F

но если есть ограничения на F - то можно в среднем минимизировать ошибку в пространстве $\lambda$


человек привыкает ко всему, даже к перевернотому миру
восприятие фрагментально


CIE Lab, XYZ - цветовые пространства

XYZ - цветовое пространство наблюдателя, зафиксированно.
изменили базис, съинтегрировали, сделали измеримым - получили Lab

использование Lab - не обоснованно
в нем яркостная компонента цвета введена в отдельную координату - правильно

закон гугера ламберта бера:

рис 8

$T(\lambda, l) = exp(l*t(\lambda))$


принтеры, мониторы и т. дю
cпектральные характеристики можно складывать
монитор просто замешивает свои базисные спектры

с принтерами все не так
несколько механизмов
1 - если на белую канву наносить пятна красителя не пересекая их - субтрактивная цветовая модель
из максимума спектров (белой бумаги) вычитаем несколько спектров
2 - льем краситель непрерывно, цветность зависит от толщины красителя
спектр ведет себя как рис 9
заслонение - краска на краску. не увидим следов первой краски.

только в Lab говориться о расстоянии

базис в цветовых пространствах задан кривыми чувствительноси человека,

RGB - не опирается на человека, скорее на камеры

цилиндрические и конические системы координат -HSV, HSI, HSB
вводится нассыщенность и цветовой тон
рис 10
проэцирование на плоскость цветности центральное или параленое - от это зависит цилиндричность или коничность системы

почему эти системы важны?
легко говорить в терминах цветового тона, яркости, нассыщеность

наиболее инвариантная компонента по отношению к окраске - цветовой тон

когда мы говорим об окраске - наиболее безопасно говорить о цветовом тоне

каналы. сколько должен иметь монитор для воспроизведения всех, желаемых нами цветов?
меньше 3ех нельзя. могли бы изображать только отрезок на цветовом треугольнике

старые мониторы воспроизводили рис 11
лучше рис 11.б сделать при 3ех каналах невозможно
5 каналов - рис 11.в
на боках треугольника - есть проблемы


рис 12 - спектр чувствительности человеческого глаза
красный и зеленый очень скорелированны
должны:
между красным и зеленым - намного больше цветов, чем между синим и зеленым

сколько красок нужно принтеру - бесконечно много. 
7 красок - можно рассчитывать на неплохую цветопередача


смотрим на красную рубашку, в цветовом пространстве видим - скорее размазанный отрезок (из точки 0 до 1, если есть блик)


цветовое распределение однородно окрашеного объекта лежит в пространствах меньшей разметности (очень редко - 0)

k-ближайщих в цветовом пространстве по этому даст убогие результаты

\chapter{лекция 3}


.....1 час лекции....

движения

$\delta x , \delta y$ - сдвиг - для определения преобразования необходимо 2 точки

$\delta x , \delta yб,\phi$ - + поворот - необходимо 3 точки

$\delta x , \delta y, \phi , s$ - + масштабирование - необходимо 4 точки

афинная группа преобразований - 6 параметров

проэктивная - 8 параметров

для любых потриколлинеарных 
единичный квадрат проэктивным преобразованием в странный четырехугольник - разорванный
по идее проэктивное преобразование сохраняет выпукласть

проэктивное преобразование может преобразованить бесконечно удаленную прямую в собственную, проходящую через изображение и наоборот

перспективное преобразование - проэктивное, реализуемое камерой, 6 параметров, группа

\section{свертки}

f свернута с g по  y это $\int_{-\inf }^{\inf} f(x)*g(y-x) dx $

cчитать сверктки от картинки.

дискретная свертка - вместо интеграла - сумма

$\sum_i f_i* g_{j-i}$

сложность О($N^2$) в асимптотике O(N*M)

теорема о свертке

$fxg=F^{-1}(F(f)*F(g)$

cложность O(N*log(N))

cвертка с прямоугольнико - за О(n)

cвертка с треугольником 
новый сдвиг вычисляется как сумма предидущего и прямоугольных сверток с разным знаком О(n)

свертка с парабодой - разница двух парабол - две треугольных свертки - вначале один смотри вниз, потом вверх O(n*k)

сложное задание - подсчитать свертку гаусианны апроксимированной 3 звеньями параболы.


самые нужные - бокс, и гаусовская сверки

композиция гаусовских сверток - гаусовская свертка, ассоциативны, нулевой элемент 

гаусовское ядро дает изотропное сглаживание и фильтр сепарабелен

размер ядра гаусиановой свертки должно быть пропорционалаен $\sigma$
jбычно $~4-6*\sigma$

алгоритм Дерише, Ван Влиит?- Диана на следующей лекции

смотрели на фильтры как на FIR фильтры - с ограниченным носителем функции рассеянья точки
можем считать ядро равным нулю, всюду, за исключением конечной области

можем смотреть на фильтры как на IIR

на входе сигнал, на выходе свертка его с экспоненциальное спадающей штукой, обрезанной с одной стороны

делаем:
$y_i=(1-\alpha)*y{i-1}+\alpha*x_i$

\section{градиент}
производная - свертка
свертка, которая ничего не делает, - дельа-функция

свертка с производной дельта-функции - производная.

дискретный аналог дельта-функции - везде 0, где-то 1 - 0000001000000

аналог производной дельта-функции - везде ноль, перед 1 в дельта-функйции - -1, после 1
000000000-10+1000000, а лучше 0000000000-1+1000000

картинку сдвинута на полпикселя относительно исходной - помнитть


дискретная свертка дл второй производной 
0000000000-12-10000000000000

в двумерный мир:
рис.13.1
   -1
 -1 0+1 
   +1
   
крест Робертса

  +1
-1    - половина оператора

градиент повернут на 45 градусов, и все съехало на полпикселя

есть еще треугольник . рис13.2
только из этого оператора можно собрать лапласиан (div(grad))) - сумма вторых производных по x и Y

  -1
-1 4-1  - оператор для лапласианна
  -1

куча методов вычисление градиента на картинке - сглаживание прямого креста


аналог градиента для цветного изображений
считать для каждой компонеты отдельно? а что потом

использование псевдоградиента Di Zenzo

vы построим директор, вектор без знака

рис. 14

запишем уравнение

рис 15

первое собственное значение - максимальная скорость псевдоградиента, второе - минимальная
первый собственный вектор - направление псевдоградиента, второй - нормаль к нему

модуль псевдоградиента считаемся разными способами:

$\sqrt{\lambda_+}$,
$\sqrt{\lambda_+ - \lambda_-}$,
$\sqrt{\lambda_+} - \sqrt{\lambda_-}$

с помощью данного оператора хорошо искать границы на изображении

говорили о псевдоградиенте

теперь о псевдолапласиане

лапласиан - это оператор второй производной

однако, вместо лапласиана используется обычно DOG - разница гаусианн

на самом деле нас интересует (картнка - сглаженная картинка) снизу ограничиваем нулем

\section{морфология}

оконные максимумы и оконные минимумы

ерозии, делатации, размыкания, замыкания

не введят новые значения в изобрадения

любые ранговые фильтры так работают

ерозия и делатация - сепарабельны. для прямоугольного структурного элемента

алгоритм Ван Херка-Дила-Вермана

возьмем два дополнительных массива 
рис. 16

О(3N)

структурный элемент. 

возьмем 9 пикселей

закрасим часть пикселей черным, остальные белым

ввели $\omega_+$ - белые, $\omega_-$ - черные

gосчитаем $max(min(\omega_+) - max(\omega_-), 0)$

это подсчет крестообразных элементв на изображении


что делать, если пики - сигнал, а не шум.

нашли сигнал без пиков, вычли его из изображения

\section{преобразования расстояния}

есть два множеста, черное и белое. и для каждого элемента мы хотим найти расстояние для ближайщего черного, или белого

расстояние может быть разным(евклидовым$(L_2)$, манхетоновским ($L_1$), $L_{\inf}$ и т. д.)
рис. 17

как считать distance transform/
он, подсчитанный для однобитного ихзобрадения, дает возможность подсчитать элементарный морфологический фильтр, с окном, являющимся порогом данного преобразования


если расстояние от элемента до ближайщего черного больше окна - оставляем белым, иначе становимя черным

сегментация с помощью дистансе трансформ


\chapter{лекция4}

коноваленко
хрень
сопоставление точек
ааааа
сопоставление объектов
бееее

\end{document}          
